---
interface Props {
    title: string;
}
const { title } = Astro.props;

import '../styles/global.css';
import '../styles/tailwind.css';

// COLORES PARA EL PORTAL ESTUDIANTE
const PRIMARY_COLOR = '#2e594d';    // Sidebar: Verde Azulado Oscuro
const ACCENT_COLOR = '#86efad';     // Acento: Verde claro
const BACKGROUND_COLOR = '#d9dde2'; // Fondo de Página: Gris sutil
const TEXT_COLOR_DARK = '#374151';  // Texto principal
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title} | Estudiante CBTA 71</title>
    <link rel="icon" href="/Logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style define:vars={{ PRIMARY_COLOR, ACCENT_COLOR, BACKGROUND_COLOR, TEXT_COLOR_DARK }}>
        body {
            font-family: 'Inter', sans-serif;
            background: var(--BACKGROUND_COLOR);
            color: var(--TEXT_COLOR_DARK);
            margin: 0;
        }
        .sidebar-closed { transform: translateX(-100%); }
        .transition-transform-fast { transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        #sidebar-menu { scrollbar-width: none; }
        #sidebar-menu::-webkit-scrollbar { width: 0; height: 0; }
        .content-fade-in { animation: fadeIn 0.8s cubic-bezier(0.19, 1, 0.22, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* ESTILO ACTIVO SEGÚN TU IMAGEN */
        .nav-active {
            background-color: white;
            color: var(--PRIMARY_COLOR) !important;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--ACCENT_COLOR);
            padding-left: 1rem;
            border-radius: 12px; /* Redondeado para que parezca una pastilla */
        }
        .nav-inactive:hover { background-color: rgba(255, 255, 255, 0.1); }
        
        .logout-icon-circle {
            background: var(--ACCENT_COLOR);
            color: var(--PRIMARY_COLOR);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="flex min-h-screen antialiased relative">
    <nav id="sidebar-menu"
        class="bg-[#2e594d] text-white flex flex-col p-5 shadow-2xl z-50 overflow-y-auto
        fixed inset-0 w-full max-w-[250px] h-full transition-transform-fast sidebar-closed
        md:fixed md:top-0 md:flex md:h-screen md:w-[250px] md:shadow-lg md:rounded-r-xl">
    
        <button id="close-sidebar-button" class="md:hidden absolute top-3 right-3 p-2 rounded-full bg-white/20 text-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path d="M18 6l-12 12M6 6l12 12"/></svg>
        </button>
        
        <div class="flex items-center gap-4 mb-10 pt-3 border-b border-white/10 pb-4">
            <div class="h-10 w-10">
                <img src="/Logo.png" alt="Logo" class="w-full h-full object-contain">
            </div>
            <div>
                <h1 class="text-xl font-extrabold tracking-wide">CBTA 71</h1>
                <p class="text-[9px] opacity-80 uppercase font-bold">Portal Estudiante</p>
            </div>
        </div>

        <div class="flex-grow overflow-y-auto pr-2">
            <ul id="main-navigation" class="space-y-2">
                <li>
                    <a href="/Estudiante/PortalEstudiante" data-path="/Estudiante/PortalEstudiante" class="nav-link nav-inactive flex items-center gap-4 py-3 px-4 rounded-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="/Estudiante/Tarjetas" data-path="/Estudiante/Tarjetas" class="nav-link nav-inactive flex items-center gap-4 py-3 px-4 rounded-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                        Mis Tarjetas
                    </a>
                </li>
                <li>
                    <a href="/Estudiante/Adeudos" data-path="/Estudiante/Adeudos" class="nav-link nav-inactive flex items-center gap-4 py-3 px-4 rounded-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Pagos Pendientes
                    </a>
                </li>
                <li>
                    <a href="/Estudiante/Historial" data-path="/Estudiante/Historial" class="nav-link nav-inactive flex items-center gap-4 py-3 px-4 rounded-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Historial
                    </a>
                </li>
            </ul>
        </div>

        <div class="mt-auto pt-4 border-t border-white/10">
            <a href="/" onclick="localStorage.clear();" class="flex items-center gap-4 py-3 px-4 rounded-lg text-white hover:bg-white/10 transition-colors font-bold">
                <div class="logout-icon-circle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                </div>
                Salir
            </a>
        </div>
    </nav>

    <main class="flex-1 p-4 md:p-8 md:ml-[250px] relative">
        <button id="open-sidebar-button" class="md:hidden fixed top-4 left-4 p-3 rounded-xl bg-[#2e594d] text-white shadow-xl z-40">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
        <div class="h-16 md:hidden"></div> 
        <div class="bg-white p-6 md:p-10 rounded-[2rem] shadow-2xl content-fade-in min-h-[calc(100vh-4rem)]">
            <slot />
        </div>
    </main>

    <script is:inline>
        const sidebar = document.getElementById('sidebar-menu');
        const openButton = document.getElementById('open-sidebar-button');
        const closeButton = document.getElementById('close-sidebar-button');
        const navLinks = document.querySelectorAll('.nav-link');
        const activeClass = 'nav-active';
        const inactiveClass = 'nav-inactive';

        function setActiveLink() {
            // Normalizar la ruta actual quitando la barra final
            let currentPath = window.location.pathname.replace(/\/$/, "");
            
            navLinks.forEach(link => {
                const linkPath = link.getAttribute('data-path').replace(/\/$/, "");
                link.classList.remove(activeClass, inactiveClass);
                
                if (linkPath === currentPath) {
                    link.classList.add(activeClass);
                } else {
                    link.classList.add(inactiveClass);
                }
            });
        }

        function openSidebar() {
            sidebar.classList.remove('sidebar-closed', 'hidden');
            openButton.style.display = 'none';
            document.body.style.overflow = 'hidden';
            if (window.innerWidth < 768) sidebar.classList.add('fixed', 'inset-0');
        }

        function closeSidebar() {
            sidebar.classList.add('sidebar-closed');
            setTimeout(() => {
                if (window.innerWidth < 768) {
                    sidebar.classList.add('hidden');
                    openButton.style.display = 'block';
                }
                document.body.style.overflow = '';
            }, 300);
        }

        openButton?.addEventListener('click', openSidebar);
        closeButton?.addEventListener('click', closeSidebar);
        
        navLinks.forEach(link => link.addEventListener('click', () => { 
            if (window.innerWidth < 768) closeSidebar(); 
        }));

        const handleResize = () => {
            if (window.innerWidth >= 768) {
                sidebar.classList.remove('hidden', 'sidebar-closed', 'inset-0');
                openButton.style.display = 'none';
                document.body.style.overflow = '';
            } else if (sidebar.classList.contains('sidebar-closed')) {
                sidebar.classList.add('hidden');
                openButton.style.display = 'block';
            }
        };

        window.addEventListener('resize', handleResize);
        window.addEventListener('load', () => { 
            handleResize(); 
            setActiveLink(); 
        });
        
        // Importante para Astro con transiciones de página
        document.addEventListener("astro:after-swap", setActiveLink);
    </script>
</body>
</html>