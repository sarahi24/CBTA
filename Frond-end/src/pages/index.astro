---
import '../styles/global.css';
import '../styles/tailwind.css';

const pageTitle = "Acceso al Sistema - SIGE";
---
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{pageTitle}</title>

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #17202A;
            background-image: radial-gradient(#2c3947 1px, transparent 0);
            background-size: 40px 40px;
        }
        .input-inset-shadow {
            background-color: #f4f7fa;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.1), inset -2px -2px 5px rgba(255, 255, 255, 0.7);
        }
        .btn-hover-green:hover {
            background-color: #43A047;
            transform: scale(1.01);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }
        [x-cloak] { display: none !important; }
    </style>
</head>

<body class="min-h-screen antialiased font-inter relative">

<section class="min-h-screen flex items-center justify-center p-4 relative z-20"
    x-data="{
        mode: 'login',
        name: '',
        email: '',
        password: '',
        confirmPassword: '',
        error: '',
        message: '',
        isLoading: false,

        handleLogin() {
            this.error = '';
            this.isLoading = true;

            if (!this.email || !this.password) {
                this.error = '‚ö†Ô∏è Por favor completa todos los campos.';
                this.isLoading = false;
                return;
            }

            const users = [
                { email: 'admin@uni.edu', pass: '123456', role: 'admin', redirect: '/Dashboard' },
                { email: 'estudiante@uni.edu', pass: 'alumno123', role: 'student', redirect: '/Estudiante/PortalEstudiante' }
            ];

            const userFound = users.find(u => u.email === this.email && u.pass === this.password);

            setTimeout(() => {
                this.isLoading = false;
                if (userFound) {
                    this.error = `‚úÖ Bienvenido. Redirigiendo...`;
                    localStorage.setItem('userRole', userFound.role);
                    setTimeout(() => window.location.href = userFound.redirect, 800);
                } else {
                    this.error = '‚ùå Credenciales incorrectas.';
                }
            }, 900);
        },

        handleRegister() {
            this.error = '';
            this.message = '';
            this.isLoading = true;

            if (!this.name || !this.email || !this.password || !this.confirmPassword) {
                this.error = '‚ö†Ô∏è Por favor, completa todos los campos de registro.';
                this.isLoading = false;
                return;
            }

            if (this.password !== this.confirmPassword) {
                this.error = '‚ö†Ô∏è Las contrase√±as no coinciden.';
                this.isLoading = false;
                return;
            }

            setTimeout(() => {
                this.isLoading = false;
                this.message = '‚úÖ Registro exitoso. Ya puedes iniciar sesi√≥n.';
                this.mode = 'login';
                this.name = ''; this.password = ''; this.confirmPassword = '';
            }, 1200);
        },

        handleRecovery() {
            this.message = '';
            this.isLoading = true;
            if (!this.email) {
                this.message = '‚ö†Ô∏è Ingresa un correo v√°lido.';
                this.isLoading = false;
                return;
            }
            setTimeout(() => {
                this.isLoading = false;
                this.message = 'üì© Se ha enviado un enlace de recuperaci√≥n a tu correo.';
            }, 900);
        }
    }"
>

    <div class="absolute top-8 left-1/2 transform -translate-x-1/2 translate-y-3 z-30">
        <img src="/Logo.png" alt="Logotipo SIGE" class="w-32 h-auto select-none pointer-events-none">
    </div>

    <div class="w-full max-w-md bg-white p-0 rounded-3xl overflow-hidden shadow-xl mt-28">

        <header class="space-y-4 pt-14 pb-6 border-b border-gray-100 text-center">
            <h1 class="text-3xl font-black text-gray-800 uppercase tracking-widest" 
                x-text="mode === 'login' ? 'SIGE' : (mode === 'register' ? 'Registro' : 'Recuperar')">
            </h1>
            <p class="text-sm text-gray-500 font-medium mt-1">Sistema Educativo</p>
        </header>

        <div class="p-8 space-y-7">
            <div x-show="error" :class="error.includes('‚úÖ') ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700'" class="p-3 border rounded-xl text-xs font-medium shadow-inner" x-cloak>
                <span x-text="error"></span>
            </div>
            <div x-show="message" :class="message.includes('üì©') || message.includes('‚úÖ') ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700'" class="p-3 border rounded-xl text-xs font-medium shadow-inner" x-cloak>
                <span x-text="message"></span>
            </div>

            <form class="space-y-6" x-show="mode === 'login'" @submit.prevent="handleLogin">
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="email" x-model="email" placeholder="Correo Electr√≥nico" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="password" x-model="password" placeholder="Contrase√±a" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <button type="submit" :disabled="isLoading" class="w-full py-3 px-4 mt-6 rounded-full shadow-xl text-base font-bold text-white bg-green-600 uppercase btn-hover-green disabled:opacity-50">
                    <span x-text="isLoading ? 'Cargando...' : 'Entrar'"></span>
                </button>
                <div class="text-center mt-4 text-xs space-y-3">
                    <button type="button" @click="mode = 'recover'; error = ''; message = '';" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                        ¬øOlvidaste tu contrase√±a?
                    </button>
                    <p class="text-gray-400">¬øNo tienes cuenta? <button type="button" @click="mode = 'register'; error = ''; message = '';" class="text-blue-600 font-bold hover:underline">Reg√≠strate</button></p>
                </div>
            </form>

            <form class="space-y-5" x-show="mode === 'register'" @submit.prevent="handleRegister" x-cloak>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="text" x-model="name" placeholder="Nombre Completo" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="email" x-model="email" placeholder="Correo Electr√≥nico" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="password" x-model="password" placeholder="Nueva Contrase√±a" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="password" x-model="confirmPassword" placeholder="Confirmar Contrase√±a" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <button type="submit" :disabled="isLoading" class="w-full py-3 px-4 rounded-full shadow-xl text-base font-bold text-white bg-green-600 uppercase btn-hover-green disabled:opacity-50">
                    <span x-text="isLoading ? 'Creando cuenta...' : 'Registrarme'"></span>
                </button>
                <div class="text-center mt-4">
                    <button type="button" @click="mode = 'login'; error = ''; message = '';" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                        ‚Üê Ya tengo cuenta, volver
                    </button>
                </div>
            </form>

            <form class="space-y-6" x-show="mode === 'recover'" @submit.prevent="handleRecovery" x-cloak>
                <div class="flex items-center rounded-xl p-3 input-inset-shadow">
                    <input type="email" x-model="email" placeholder="Ingresa tu correo" class="w-full bg-transparent placeholder-gray-500 text-sm border-none focus:ring-0">
                </div>
                <button type="submit" :disabled="isLoading" class="w-full py-3 px-4 rounded-full shadow-xl text-base font-bold text-white bg-green-600 uppercase btn-hover-green disabled:opacity-50">
                    <span x-text="isLoading ? 'Enviando...' : 'Enviar Enlace'"></span>
                </button>
                <div class="text-center mt-4">
                    <button type="button" @click="mode = 'login'; error = ''; message = '';" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                        ‚Üê Volver al inicio de sesi√≥n
                    </button>
                </div>
            </form>
        </div>

        <footer class="text-center p-3 bg-gray-100 text-xs text-gray-500 border-t border-gray-200">
            <p>2026 ¬© SIGE</p>
        </footer>
    </div>
</section>

<script>
  import Alpine from 'alpinejs';
  window.Alpine = Alpine;
  Alpine.start();
</script>

</body>
</html>
