import { e as createComponent, k as renderComponent, r as renderTemplate, l as defineScriptVars, h as addAttribute, m as maybeRenderHead } from '../chunks/astro/server_6O5fLeT-.mjs';
import 'piccolore';
import { $ as $$Layout } from '../chunks/Layout_CIeDwhMC.mjs';
/* empty css                                    */
export { renderers } from '../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Payments = createComponent(async ($$result, $$props, $$slots) => {
  const pageTitle = "Historial de Pagos - CBTA 71";
  const CAREER_MAP = {
    "TAG-E": "T\xE9cnico Agropecuario",
    "TOF": "T\xE9cnico en Ofim\xE1tica",
    "TEM": "T\xE9cnico en Adm\xF3n. de Emprendimiento",
    "TAG-M": "T\xE9cnico Agropecuario (Mixta)",
    "TRH": "T\xE9cnico en Adm\xF3n. de Recursos Humanos (Mixta)",
    "": "Sin Carrera"
  };
  let students = [];
  try {
    const res = await fetch("/api/students");
    if (res.ok) {
      const json = await res.json();
      students = Array.isArray(json) ? json : Array.isArray(json.data) ? json.data : [];
    }
  } catch (e) {
  }
  if (!students.length) {
    students = [];
  }
  const safeStudents = students.map((s, i) => ({
    id: s.id ?? String(i + 1),
    numControl: s.numControl ?? s.id ?? "",
    nombre: s.nombre ?? s.name ?? "",
    apellidoP: s.apellidoP ?? s.apellidoPaterno ?? "",
    apellidoM: s.apellidoM ?? s.apellidoMaterno ?? "",
    semestre: s.semestre ?? "1",
    carrera: s.carrera ?? ""
  }));
  const studentsJSON = JSON.stringify(safeStudents).replace(/</g, "\\u003c");
  const careerMapJSON = JSON.stringify(CAREER_MAP);
  return renderTemplate`${renderComponent($$result, "Layout", $$Layout, { "title": pageTitle }, { "default": async ($$result2) => renderTemplate(_a || (_a = __template(['  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" defer><\/script> ', '<div class="max-w-7xl mx-auto px-6 py-10 bg-white min-h-screen"> <div class="flex items-center gap-5 mb-8"> <div class="w-16 h-16 bg-[#eaf1ef] rounded-2xl flex items-center justify-center border-2 border-[#2E594D] shrink-0"> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2E594D" stroke-width="2.5"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> </div> <div> <h1 class="text-3xl font-black text-gray-800 tracking-tight leading-none">Historial de Pagos Realizados</h1> <p class="text-gray-500 font-medium mt-1">Panel de control y auditor\xEDa financiera</p> </div> </div> <div class="flex flex-row items-center gap-3 mb-8 w-full"> <div class="relative flex-grow"> <input type="text" id="search-input" placeholder="Buscar por nombre, matr\xEDcula o concepto..." class="w-full pl-12 pr-4 h-[46px] bg-gray-50 border border-gray-200 rounded-xl text-sm text-gray-700 focus:ring-2 focus:ring-[#2E594D] focus:bg-white outline-none transition-all shadow-sm"> <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> </div> <div class="flex items-center gap-2 relative"> <button id="toggle-filters" class="flex items-center gap-2 px-5 h-[46px] border-2 border-[#2E594D] text-[#2E594D] font-bold text-sm rounded-xl hover:bg-[#2E594D] hover:text-white transition-all shadow-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>\nFiltros\n</button> <button id="export-xlsx" class="flex items-center gap-2 px-5 h-[46px] bg-emerald-700 text-white font-bold text-sm rounded-xl hover:bg-emerald-800 transition-all shadow-lg active:scale-95"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>\nEXPORTAR REPORTE\n</button> <div id="filter-menu" class="filter-card"> <h3 class="font-bold text-slate-800 mb-4 border-b pb-2">Opciones de Filtrado</h3> <div class="space-y-4"> <div> <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Semestre:</label> <select id="semester-filter" class="w-full mt-1 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-[#2E594D]"> <option value="all">Todos</option> ', ' </select> </div> <div> <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">M\xE9todo:</label> <select id="method-filter" class="w-full mt-1 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-[#2E594D]"> <option value="all">Todos</option> <option value="Efectivo">Efectivo</option> <option value="Transferencia">Transferencia</option> <option value="Dep\xF3sito">Dep\xF3sito</option> </select> </div> <button id="clear-filters" class="w-full mt-2 p-2 bg-red-50 text-red-500 rounded-lg text-sm font-bold hover:bg-red-100 transition-colors">Limpiar Filtros</button> </div> </div> </div> </div> <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden mb-8"> <div class="overflow-x-auto"> <table class="w-full border-collapse"> <thead> <tr class="bg-[#2E594D] text-white"> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Fecha</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Concepto de Pago</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Estudiante</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">M\xE9todo</th> <th class="px-6 py-5 text-right text-xs font-black uppercase tracking-widest">Monto</th> </tr> </thead> <tbody id="payments-table-body" class="divide-y divide-gray-50"></tbody> </table> </div> </div> <div class="flex flex-col items-center gap-4 py-4"> <p class="text-slate-500 text-sm font-medium">Registros: <span id="p-total" class="font-bold text-slate-800">0</span></p> <div class="flex items-center gap-2" id="pagination-controls"></div> </div> </div> <script>(function(){', "\nwindow.__INITIAL_STUDENTS_PAYMENTS = JSON.parse(studentsJSON);\nwindow.__CAREER_MAP = JSON.parse(careerMapJSON);\n})();<\/script> <script type=\"module\">\n(function() {\n    let currentPage = 1;\n    const itemsPerPage = 50;\n    let filteredData = [];\n\n    const tableBody = document.getElementById('payments-table-body');\n    const searchInput = document.getElementById('search-input');\n    const filterMenu = document.getElementById('filter-menu');\n    const btnExport = document.getElementById('export-xlsx');\n\n    document.getElementById('toggle-filters').onclick = (e) => { e.stopPropagation(); filterMenu.classList.toggle('show'); };\n    document.onclick = () => filterMenu.classList.remove('show');\n    filterMenu.onclick = (e) => e.stopPropagation();\n\n    const render = () => {\n        const students = JSON.parse(localStorage.getItem('studentsList') || '[]') || window.__INITIAL_STUDENTS_PAYMENTS;\n        const allCharges = JSON.parse(localStorage.getItem('chargesList') || '[]').filter(c => \n            ['paid', 'pagado'].includes(String(c.status || '').toLowerCase())\n        );\n\n        const term = searchInput.value.toLowerCase();\n        const semesterSel = document.getElementById('semester-filter').value;\n        const methodSel = document.getElementById('method-filter').value;\n\n        filteredData = allCharges.filter(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            if(!s) return false;\n            \n            const conceptoReal = p.conceptTitle || p.conceptName || p.conceptText || p.concept || p.title || 'PAGO GENERAL';\n            const fullName = `${s.nombre} ${s.apellidoP} ${s.apellidoM}`.toLowerCase();\n            \n            const matchesSearch = fullName.includes(term) || String(s.numControl).includes(term) || conceptoReal.toLowerCase().includes(term);\n            const matchesSemester = semesterSel === 'all' || String(s.semestre) === semesterSel;\n            const matchesMethod = methodSel === 'all' || p.paymentMethod === methodSel;\n            \n            return matchesSearch && matchesSemester && matchesMethod;\n        });\n\n        const startIdx = (currentPage - 1) * itemsPerPage;\n        const pageItems = filteredData.slice(startIdx, startIdx + itemsPerPage);\n\n        tableBody.innerHTML = pageItems.map(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            const displayConcept = p.conceptTitle || p.conceptName || p.conceptText || p.concept || p.title || 'PAGO REGISTRADO';\n\n            return `\n                <tr class=\"hover:bg-gray-50/50 transition-colors\">\n                    <td class=\"px-6 py-5 text-gray-500 font-mono text-xs\">${new Date(p.paidAt || p.date).toLocaleDateString('es-MX')}</td>\n                    <td class=\"px-6 py-5\">\n                        <span class=\"text-gray-900 font-extrabold text-xs uppercase block\" style=\"letter-spacing: -0.01em;\">\n                            ${displayConcept}\n                        </span>\n                    </td>\n                    <td class=\"px-6 py-5\">\n                        <div class=\"flex flex-col\">\n                            <span class=\"text-gray-800 font-bold text-xs uppercase leading-tight\">${s.nombre} ${s.apellidoP} ${s.apellidoM}</span>\n                            <span class=\"text-[9px] text-gray-400 font-mono\">${s.numControl}</span>\n                        </div>\n                    </td>\n                    <td class=\"px-6 py-5 text-[10px] font-bold text-gray-400 uppercase\">${p.paymentMethod || 'EFECTIVO'}</td>\n                    <td class=\"px-6 py-5 text-right font-black text-[#2E594D] text-sm\">\n                        $${Number(p.amount).toLocaleString('es-MX', {minimumFractionDigits:2})}\n                    </td>\n                </tr>\n            `;\n        }).join('');\n\n        document.getElementById('p-total').textContent = filteredData.length;\n        renderPagination(Math.ceil(filteredData.length / itemsPerPage));\n    };\n\n    const renderPagination = (totalPages) => {\n        const controls = document.getElementById('pagination-controls');\n        if(totalPages <= 1) { controls.innerHTML = ''; return; }\n        let html = '';\n        for(let i=1; i<=totalPages; i++) {\n            html += `<button class=\"page-link ${i === currentPage ? 'active' : ''}\" data-page=\"${i}\">${i}</button>`;\n        }\n        controls.innerHTML = html;\n        controls.querySelectorAll('button').forEach(b => {\n            b.onclick = () => { currentPage = parseInt(b.dataset.page); render(); };\n        });\n    };\n\n    // --- NUEVA L\xD3GICA DE EXPORTACI\xD3N POR CARRERAS ---\n    btnExport.onclick = () => {\n        if(filteredData.length === 0) return alert(\"No hay datos para exportar\");\n        \n        const students = JSON.parse(localStorage.getItem('studentsList') || '[]') || window.__INITIAL_STUDENTS_PAYMENTS;\n        const CAREER_MAP = window.__CAREER_MAP;\n        const wb = XLSX.utils.book_new();\n\n        // 1. Identificar las carreras \xFAnicas presentes en los resultados filtrados\n        const uniqueCareers = [...new Set(filteredData.map(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            return s ? s.carrera : '';\n        }))];\n\n        // 2. Crear una pesta\xF1a por cada carrera\n        uniqueCareers.forEach(careerCode => {\n            const paymentsInCareer = filteredData.filter(p => {\n                const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n                return s && s.carrera === careerCode;\n            });\n\n            // Ordenar por semestre y luego por nombre\n            const sortedPayments = paymentsInCareer.sort((a, b) => {\n                const sA = students.find(x => String(x.id) === String(a.studentId) || String(x.numControl) === String(a.studentId));\n                const sB = students.find(x => String(x.id) === String(b.studentId) || String(x.numControl) === String(b.studentId));\n                return (sA.semestre - sB.semestre) || `${sA.nombre}`.localeCompare(`${sB.nombre}`);\n            });\n\n            const exportData = sortedPayments.map(p => {\n                const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n                return {\n                    'Fecha': new Date(p.paidAt || p.date).toLocaleDateString('es-MX'),\n                    'Semestre': s.semestre + '\xBA',\n                    'Matr\xEDcula': s.numControl,\n                    'Estudiante': `${s.nombre} ${s.apellidoP} ${s.apellidoM}`,\n                    'Concepto': p.conceptTitle || p.conceptName || p.concept || p.title || 'PAGO',\n                    'M\xE9todo': p.paymentMethod || 'Efectivo',\n                    'Monto ($)': Number(p.amount)\n                };\n            });\n\n            if (exportData.length > 0) {\n                const ws = XLSX.utils.json_to_sheet(exportData);\n                \n                // Nombre de la hoja limpio y corto (M\xE1x 31 caracteres para Excel)\n                let sheetName = (CAREER_MAP[careerCode] || careerCode || 'General')\n                    .replace(/[\\\\*?:/\\[\\]]/g, '')\n                    .substring(0, 31);\n                \n                XLSX.utils.book_append_sheet(wb, ws, sheetName);\n            }\n        });\n\n        XLSX.writeFile(wb, `Reporte_Pagos_CBTA71_${new Date().toLocaleDateString().replace(/\\//g, '-')}.xlsx`);\n    };\n\n    searchInput.oninput = () => { currentPage = 1; render(); };\n    document.getElementById('semester-filter').onchange = () => { currentPage = 1; render(); };\n    document.getElementById('method-filter').onchange = () => { currentPage = 1; render(); };\n    document.getElementById('clear-filters').onclick = () => { \n        searchInput.value = ''; \n        document.getElementById('semester-filter').value = 'all'; \n        document.getElementById('method-filter').value = 'all'; \n        render(); \n    };\n\n    render();\n})();\n<\/script> "], ['  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" defer><\/script> ', '<div class="max-w-7xl mx-auto px-6 py-10 bg-white min-h-screen"> <div class="flex items-center gap-5 mb-8"> <div class="w-16 h-16 bg-[#eaf1ef] rounded-2xl flex items-center justify-center border-2 border-[#2E594D] shrink-0"> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2E594D" stroke-width="2.5"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> </div> <div> <h1 class="text-3xl font-black text-gray-800 tracking-tight leading-none">Historial de Pagos Realizados</h1> <p class="text-gray-500 font-medium mt-1">Panel de control y auditor\xEDa financiera</p> </div> </div> <div class="flex flex-row items-center gap-3 mb-8 w-full"> <div class="relative flex-grow"> <input type="text" id="search-input" placeholder="Buscar por nombre, matr\xEDcula o concepto..." class="w-full pl-12 pr-4 h-[46px] bg-gray-50 border border-gray-200 rounded-xl text-sm text-gray-700 focus:ring-2 focus:ring-[#2E594D] focus:bg-white outline-none transition-all shadow-sm"> <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> </div> <div class="flex items-center gap-2 relative"> <button id="toggle-filters" class="flex items-center gap-2 px-5 h-[46px] border-2 border-[#2E594D] text-[#2E594D] font-bold text-sm rounded-xl hover:bg-[#2E594D] hover:text-white transition-all shadow-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>\nFiltros\n</button> <button id="export-xlsx" class="flex items-center gap-2 px-5 h-[46px] bg-emerald-700 text-white font-bold text-sm rounded-xl hover:bg-emerald-800 transition-all shadow-lg active:scale-95"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>\nEXPORTAR REPORTE\n</button> <div id="filter-menu" class="filter-card"> <h3 class="font-bold text-slate-800 mb-4 border-b pb-2">Opciones de Filtrado</h3> <div class="space-y-4"> <div> <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Semestre:</label> <select id="semester-filter" class="w-full mt-1 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-[#2E594D]"> <option value="all">Todos</option> ', ' </select> </div> <div> <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">M\xE9todo:</label> <select id="method-filter" class="w-full mt-1 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-[#2E594D]"> <option value="all">Todos</option> <option value="Efectivo">Efectivo</option> <option value="Transferencia">Transferencia</option> <option value="Dep\xF3sito">Dep\xF3sito</option> </select> </div> <button id="clear-filters" class="w-full mt-2 p-2 bg-red-50 text-red-500 rounded-lg text-sm font-bold hover:bg-red-100 transition-colors">Limpiar Filtros</button> </div> </div> </div> </div> <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden mb-8"> <div class="overflow-x-auto"> <table class="w-full border-collapse"> <thead> <tr class="bg-[#2E594D] text-white"> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Fecha</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Concepto de Pago</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">Estudiante</th> <th class="px-6 py-5 text-left text-xs font-black uppercase tracking-widest">M\xE9todo</th> <th class="px-6 py-5 text-right text-xs font-black uppercase tracking-widest">Monto</th> </tr> </thead> <tbody id="payments-table-body" class="divide-y divide-gray-50"></tbody> </table> </div> </div> <div class="flex flex-col items-center gap-4 py-4"> <p class="text-slate-500 text-sm font-medium">Registros: <span id="p-total" class="font-bold text-slate-800">0</span></p> <div class="flex items-center gap-2" id="pagination-controls"></div> </div> </div> <script>(function(){', "\nwindow.__INITIAL_STUDENTS_PAYMENTS = JSON.parse(studentsJSON);\nwindow.__CAREER_MAP = JSON.parse(careerMapJSON);\n})();<\/script> <script type=\"module\">\n(function() {\n    let currentPage = 1;\n    const itemsPerPage = 50;\n    let filteredData = [];\n\n    const tableBody = document.getElementById('payments-table-body');\n    const searchInput = document.getElementById('search-input');\n    const filterMenu = document.getElementById('filter-menu');\n    const btnExport = document.getElementById('export-xlsx');\n\n    document.getElementById('toggle-filters').onclick = (e) => { e.stopPropagation(); filterMenu.classList.toggle('show'); };\n    document.onclick = () => filterMenu.classList.remove('show');\n    filterMenu.onclick = (e) => e.stopPropagation();\n\n    const render = () => {\n        const students = JSON.parse(localStorage.getItem('studentsList') || '[]') || window.__INITIAL_STUDENTS_PAYMENTS;\n        const allCharges = JSON.parse(localStorage.getItem('chargesList') || '[]').filter(c => \n            ['paid', 'pagado'].includes(String(c.status || '').toLowerCase())\n        );\n\n        const term = searchInput.value.toLowerCase();\n        const semesterSel = document.getElementById('semester-filter').value;\n        const methodSel = document.getElementById('method-filter').value;\n\n        filteredData = allCharges.filter(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            if(!s) return false;\n            \n            const conceptoReal = p.conceptTitle || p.conceptName || p.conceptText || p.concept || p.title || 'PAGO GENERAL';\n            const fullName = \\`\\${s.nombre} \\${s.apellidoP} \\${s.apellidoM}\\`.toLowerCase();\n            \n            const matchesSearch = fullName.includes(term) || String(s.numControl).includes(term) || conceptoReal.toLowerCase().includes(term);\n            const matchesSemester = semesterSel === 'all' || String(s.semestre) === semesterSel;\n            const matchesMethod = methodSel === 'all' || p.paymentMethod === methodSel;\n            \n            return matchesSearch && matchesSemester && matchesMethod;\n        });\n\n        const startIdx = (currentPage - 1) * itemsPerPage;\n        const pageItems = filteredData.slice(startIdx, startIdx + itemsPerPage);\n\n        tableBody.innerHTML = pageItems.map(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            const displayConcept = p.conceptTitle || p.conceptName || p.conceptText || p.concept || p.title || 'PAGO REGISTRADO';\n\n            return \\`\n                <tr class=\"hover:bg-gray-50/50 transition-colors\">\n                    <td class=\"px-6 py-5 text-gray-500 font-mono text-xs\">\\${new Date(p.paidAt || p.date).toLocaleDateString('es-MX')}</td>\n                    <td class=\"px-6 py-5\">\n                        <span class=\"text-gray-900 font-extrabold text-xs uppercase block\" style=\"letter-spacing: -0.01em;\">\n                            \\${displayConcept}\n                        </span>\n                    </td>\n                    <td class=\"px-6 py-5\">\n                        <div class=\"flex flex-col\">\n                            <span class=\"text-gray-800 font-bold text-xs uppercase leading-tight\">\\${s.nombre} \\${s.apellidoP} \\${s.apellidoM}</span>\n                            <span class=\"text-[9px] text-gray-400 font-mono\">\\${s.numControl}</span>\n                        </div>\n                    </td>\n                    <td class=\"px-6 py-5 text-[10px] font-bold text-gray-400 uppercase\">\\${p.paymentMethod || 'EFECTIVO'}</td>\n                    <td class=\"px-6 py-5 text-right font-black text-[#2E594D] text-sm\">\n                        $\\${Number(p.amount).toLocaleString('es-MX', {minimumFractionDigits:2})}\n                    </td>\n                </tr>\n            \\`;\n        }).join('');\n\n        document.getElementById('p-total').textContent = filteredData.length;\n        renderPagination(Math.ceil(filteredData.length / itemsPerPage));\n    };\n\n    const renderPagination = (totalPages) => {\n        const controls = document.getElementById('pagination-controls');\n        if(totalPages <= 1) { controls.innerHTML = ''; return; }\n        let html = '';\n        for(let i=1; i<=totalPages; i++) {\n            html += \\`<button class=\"page-link \\${i === currentPage ? 'active' : ''}\" data-page=\"\\${i}\">\\${i}</button>\\`;\n        }\n        controls.innerHTML = html;\n        controls.querySelectorAll('button').forEach(b => {\n            b.onclick = () => { currentPage = parseInt(b.dataset.page); render(); };\n        });\n    };\n\n    // --- NUEVA L\xD3GICA DE EXPORTACI\xD3N POR CARRERAS ---\n    btnExport.onclick = () => {\n        if(filteredData.length === 0) return alert(\"No hay datos para exportar\");\n        \n        const students = JSON.parse(localStorage.getItem('studentsList') || '[]') || window.__INITIAL_STUDENTS_PAYMENTS;\n        const CAREER_MAP = window.__CAREER_MAP;\n        const wb = XLSX.utils.book_new();\n\n        // 1. Identificar las carreras \xFAnicas presentes en los resultados filtrados\n        const uniqueCareers = [...new Set(filteredData.map(p => {\n            const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n            return s ? s.carrera : '';\n        }))];\n\n        // 2. Crear una pesta\xF1a por cada carrera\n        uniqueCareers.forEach(careerCode => {\n            const paymentsInCareer = filteredData.filter(p => {\n                const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n                return s && s.carrera === careerCode;\n            });\n\n            // Ordenar por semestre y luego por nombre\n            const sortedPayments = paymentsInCareer.sort((a, b) => {\n                const sA = students.find(x => String(x.id) === String(a.studentId) || String(x.numControl) === String(a.studentId));\n                const sB = students.find(x => String(x.id) === String(b.studentId) || String(x.numControl) === String(b.studentId));\n                return (sA.semestre - sB.semestre) || \\`\\${sA.nombre}\\`.localeCompare(\\`\\${sB.nombre}\\`);\n            });\n\n            const exportData = sortedPayments.map(p => {\n                const s = students.find(x => String(x.id) === String(p.studentId) || String(x.numControl) === String(p.studentId));\n                return {\n                    'Fecha': new Date(p.paidAt || p.date).toLocaleDateString('es-MX'),\n                    'Semestre': s.semestre + '\xBA',\n                    'Matr\xEDcula': s.numControl,\n                    'Estudiante': \\`\\${s.nombre} \\${s.apellidoP} \\${s.apellidoM}\\`,\n                    'Concepto': p.conceptTitle || p.conceptName || p.concept || p.title || 'PAGO',\n                    'M\xE9todo': p.paymentMethod || 'Efectivo',\n                    'Monto ($)': Number(p.amount)\n                };\n            });\n\n            if (exportData.length > 0) {\n                const ws = XLSX.utils.json_to_sheet(exportData);\n                \n                // Nombre de la hoja limpio y corto (M\xE1x 31 caracteres para Excel)\n                let sheetName = (CAREER_MAP[careerCode] || careerCode || 'General')\n                    .replace(/[\\\\\\\\*?:/\\\\[\\\\]]/g, '')\n                    .substring(0, 31);\n                \n                XLSX.utils.book_append_sheet(wb, ws, sheetName);\n            }\n        });\n\n        XLSX.writeFile(wb, \\`Reporte_Pagos_CBTA71_\\${new Date().toLocaleDateString().replace(/\\\\//g, '-')}.xlsx\\`);\n    };\n\n    searchInput.oninput = () => { currentPage = 1; render(); };\n    document.getElementById('semester-filter').onchange = () => { currentPage = 1; render(); };\n    document.getElementById('method-filter').onchange = () => { currentPage = 1; render(); };\n    document.getElementById('clear-filters').onclick = () => { \n        searchInput.value = ''; \n        document.getElementById('semester-filter').value = 'all'; \n        document.getElementById('method-filter').value = 'all'; \n        render(); \n    };\n\n    render();\n})();\n<\/script> "])), maybeRenderHead(), [...Array(10)].map((_, i) => renderTemplate`<option${addAttribute(i + 1, "value")}>${i + 1}ยบ Semestre</option>`), defineScriptVars({ studentsJSON, careerMapJSON })) })}`;
}, "C:/Users/sarah/Documents/GitHub/CBTA/Frond-end/src/pages/payments.astro", void 0);

const $$file = "C:/Users/sarah/Documents/GitHub/CBTA/Frond-end/src/pages/payments.astro";
const $$url = "/payments";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Payments,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
