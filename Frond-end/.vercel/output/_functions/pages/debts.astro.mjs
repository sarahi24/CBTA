import { e as createComponent, k as renderComponent, r as renderTemplate, l as defineScriptVars, m as maybeRenderHead } from '../chunks/astro/server_6O5fLeT-.mjs';
import 'piccolore';
import { $ as $$Layout } from '../chunks/Layout_CIeDwhMC.mjs';
export { renderers } from '../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Debts = createComponent(($$result, $$props, $$slots) => {
  const pageTitle = "Estado de Adeudos - CBTA 71";
  const CAREER_MAP = {
    "TAG-E": "T\xE9cnico Agropecuario",
    "TOF": "T\xE9cnico en Ofim\xE1tica",
    "TEM": "T\xE9cnico en Adm\xF3n. de Emprendimiento",
    "TAG-M": "T\xE9cnico Agropecuario (Mixta)",
    "TRH": "T\xE9cnico en Adm\xF3n. de Recursos Humanos (Mixta)",
    "": "Sin Carrera"
  };
  const careerMapJSON = JSON.stringify(CAREER_MAP);
  return renderTemplate`${renderComponent($$result, "Layout", $$Layout, { "title": pageTitle }, { "default": ($$result2) => renderTemplate(_a || (_a = __template([" ", '<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 bg-gray-50/50 min-h-screen"> <header class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-10 pb-8 border-b-2 border-[#2D584C]/10"> <div class="flex items-center gap-4 w-full justify-start"> <div class="p-3 bg-[#2D584C] rounded-xl shadow-lg shrink-0"> <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8V6m0 4v2m0 2v2m0 0V4m-7 8a7 7 0 1114 0 7 7 0 01-14 0z"></path> </svg> </div> <div class="text-left"> <h1 class="text-3xl font-black text-gray-900 tracking-tight leading-none text-left">Estado de Adeudos</h1> <p class="text-sm text-gray-500 mt-1 font-medium text-left">Cargos pendientes por cobrar.</p> </div> </div> <div class="flex flex-wrap items-center gap-3 w-full lg:w-auto justify-start lg:justify-end"> <div class="relative w-full lg:w-[300px]"> <input type="text" id="search-input" placeholder="Buscar alumno..." class="w-full pl-4 h-[46px] border-2 border-gray-200 rounded-xl text-sm outline-none focus:border-[#2D584C] bg-white shadow-sm"> </div> <button id="open-pay-modal-btn" class="h-[46px] px-5 bg-[#2D584C] text-white rounded-xl shadow-md hover:brightness-110 transition-all flex items-center justify-center text-[10px] font-black uppercase tracking-widest gap-2 shrink-0">\nRegistrar Pago\n</button> <button id="export-xlsx" class="h-[46px] px-5 bg-emerald-600 text-white rounded-xl shadow-md hover:bg-emerald-700 transition-all flex items-center justify-center text-[10px] font-black uppercase tracking-widest gap-2">\nEXPORTAR EXCEL\n</button> </div> </header> <div class="bg-white rounded-[2rem] shadow-2xl border border-gray-100 overflow-hidden"> <div class="overflow-x-auto"> <table class="min-w-full border-collapse"> <thead class="bg-[#2D584C]"> <tr> <th class="px-8 py-5 text-left text-[10px] font-black text-white uppercase tracking-widest">Estudiante</th> <th class="px-8 py-5 text-left text-[10px] font-black text-white uppercase tracking-widest">Concepto</th> <th class="px-8 py-5 text-right text-[10px] font-black text-white uppercase tracking-widest">Monto</th> </tr> </thead> <tbody id="payments-table-body" class="bg-white divide-y divide-gray-50"></tbody> </table> </div> <div class="px-8 py-4 bg-gray-50 border-t border-gray-100 flex flex-col sm:flex-row justify-between items-center gap-4"> <span id="pagination-info" class="text-[11px] font-bold text-gray-500 uppercase">Mostrando 0 de 0 adeudos</span> <div class="flex items-center gap-2" id="pagination-buttons"></div> </div> </div> </div> <div id="pay-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm p-4 text-left"> <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl"> <div class="flex justify-between items-center mb-4 border-b pb-3"> <h3 class="text-lg font-black text-gray-900">Registrar Pago</h3> <button id="pay-close-x" class="text-gray-400">\u2715</button> </div> <form id="pay-form" class="space-y-3"> <div class="grid grid-cols-2 gap-3"> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Referencia / Folio</label> <input id="pay-code" type="text" placeholder="Ej: 4567" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold uppercase" required> </div> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">M\xE9todo</label> <select id="pay-method" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold" required> <option value="Transferencia">Transferencia</option> <option value="Dep\xF3sito">Dep\xF3sito</option> </select> </div> </div> <div class="relative"> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Buscar Alumno</label> <input id="pay-student-search" type="text" autocomplete="off" placeholder="Nombre o No. Control..." class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs"> <div id="autocomplete-list" class="absolute z-20 w-full bg-white border rounded-xl mt-1 shadow-2xl max-h-40 overflow-y-auto hidden"></div> </div> <div id="selected-student-info" class="hidden p-3 bg-emerald-50 border border-emerald-100 rounded-lg"> <div id="display-student-name" class="text-[11px] font-black text-[#2D584C] uppercase"></div> <div id="display-student-control" class="text-[9px] font-mono font-bold text-emerald-600/70"></div> </div> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Adeudo Correspondiente</label> <select id="pay-charge-id" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold disabled:opacity-50" disabled required> <option value="">Primero selecciona un alumno</option> </select> </div> <div class="flex justify-end gap-2 pt-3 border-t mt-4"> <button type="button" id="pay-cancel" class="px-4 py-2 text-gray-400 font-bold text-[9px] uppercase">Cancelar</button> <button type="submit" class="px-6 py-2 bg-[#2D584C] text-white rounded-lg font-black text-[9px] uppercase tracking-widest">Confirmar Pago</button> </div> </form> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" referrerpolicy="no-referrer" defer><\/script> <script>(function(){', "\n    window.__CAREER_MAP = JSON.parse(careerMapJSON);\n  })();<\/script> <script type=\"module\">\n    const ITEMS_PER_PAGE = 50;\n    let currentPage = 1;\n\n    const getCharges = () => JSON.parse(localStorage.getItem('chargesList') || '[]');\n    const getStudents = () => JSON.parse(localStorage.getItem('studentsList') || '[]');\n    const getConcepts = () => JSON.parse(localStorage.getItem('conceptsList') || '[]');\n    const saveCharges = (data) => localStorage.setItem('chargesList', JSON.stringify(data));\n    const fmt = n => '$' + Number(n).toLocaleString('es-MX', { minimumFractionDigits: 2 });\n\n    const tableBody = document.getElementById('payments-table-body');\n    const searchInput = document.getElementById('search-input');\n    const paginationInfo = document.getElementById('pagination-info');\n    const paginationButtons = document.getElementById('pagination-buttons');\n\n    function renderTable() {\n        const term = searchInput.value.toLowerCase();\n        const students = getStudents();\n        const concepts = getConcepts();\n        \n        const allPending = getCharges().filter(c => !['paid', 'pagado'].includes(String(c.status).toLowerCase()));\n        \n        const filtered = allPending.filter(ch => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const sFullName = `${s.nombre} ${s.apellidoP} ${s.apellidoM}`.toLowerCase();\n            return !term || sFullName.includes(term) || String(s.numControl).includes(term);\n        });\n\n        const totalItems = filtered.length;\n        const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n        if (currentPage > totalPages) currentPage = totalPages || 1;\n        \n        const start = (currentPage - 1) * ITEMS_PER_PAGE;\n        const pageData = filtered.slice(start, start + ITEMS_PER_PAGE);\n\n        tableBody.innerHTML = pageData.map((ch) => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n            const conceptName = c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept || 'CARGO');\n            const sFullName = [s.nombre, s.apellidoP, s.apellidoM].filter(Boolean).join(' ');\n\n            return `\n              <tr class=\"hover:bg-gray-50 transition-all border-l-4 border-transparent hover:border-[#2D584C]\">\n                <td class=\"px-8 py-5\">\n                    <div class=\"text-[12px] font-black text-gray-900 uppercase\">${sFullName}</div>\n                    <div class=\"text-[9px] text-gray-400 font-mono font-bold\">${s.numControl || '-'}</div>\n                </td>\n                <td class=\"px-8 py-5 text-[11px] text-gray-500 font-bold uppercase\">${conceptName}</td>\n                <td class=\"px-8 py-5 text-right text-sm font-black text-red-600 font-mono\">${fmt(ch.amount)}</td>\n              </tr>\n            `;\n        }).join('');\n\n        updatePaginationControls(totalItems, totalPages);\n    }\n\n    function updatePaginationControls(totalItems, totalPages) {\n        const startItem = totalItems === 0 ? 0 : (currentPage - 1) * ITEMS_PER_PAGE + 1;\n        const endItem = Math.min(currentPage * ITEMS_PER_PAGE, totalItems);\n        paginationInfo.innerText = `Mostrando ${startItem}-${endItem} de ${totalItems} registros`;\n        paginationButtons.innerHTML = '';\n        if (totalPages <= 1) return;\n        \n        const createBtn = (text, targetPage, active = false, disabled = false) => {\n            const btn = document.createElement('button');\n            btn.innerText = text;\n            btn.className = `min-w-[32px] h-8 px-2 rounded-lg text-xs font-black ${active ? 'bg-[#2D584C] text-white' : disabled ? 'text-gray-300' : 'text-gray-500 hover:bg-gray-200'}`;\n            if (!disabled) btn.onclick = () => { currentPage = targetPage; renderTable(); window.scrollTo(0,0); };\n            return btn;\n        };\n        paginationButtons.appendChild(createBtn('\u2190', currentPage - 1, false, currentPage === 1));\n        for (let i = 1; i <= totalPages; i++) {\n            if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {\n                paginationButtons.appendChild(createBtn(i, i, currentPage === i));\n            }\n        }\n        paginationButtons.appendChild(createBtn('\u2192', currentPage + 1, false, currentPage === totalPages));\n    }\n\n    // --- L\xD3GICA DE EXPORTACI\xD3N EXCEL ---\n    document.getElementById('export-xlsx').onclick = () => {\n        const charges = getCharges().filter(c => !['paid', 'pagado'].includes(String(c.status).toLowerCase()));\n        const students = getStudents();\n        const concepts = getConcepts();\n\n        const data = charges.map(ch => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n            return {\n                'No. Control': s.numControl || 'N/A',\n                'Nombre Completo': `${s.nombre || ''} ${s.apellidoP || ''} ${s.apellidoM || ''}`.trim(),\n                'Carrera': window.__CAREER_MAP[s.carrera] || s.carrera || 'N/A',\n                'Grado/Grupo': `${s.grado || ''}\xB0 ${s.grupo || ''}`,\n                'Concepto': c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept),\n                'Monto': ch.amount,\n                'Estatus': 'PENDIENTE'\n            };\n        });\n\n        const worksheet = XLSX.utils.json_to_sheet(data);\n        const workbook = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(workbook, worksheet, \"Adeudos\");\n        XLSX.writeFile(workbook, `Adeudos_CBTA71_${new Date().toLocaleDateString()}.xlsx`);\n    };\n\n    // --- L\xD3GICA DEL MODAL Y AUTOCOMPLETADO ---\n    const modal = document.getElementById('pay-modal');\n    const paySearchInput = document.getElementById('pay-student-search');\n    const autocompleteList = document.getElementById('autocomplete-list');\n    const selectedInfo = document.getElementById('selected-student-info');\n    const chargeSelect = document.getElementById('pay-charge-id');\n\n    document.getElementById('open-pay-modal-btn').onclick = () => {\n        document.getElementById('pay-form').reset();\n        selectedInfo.classList.add('hidden');\n        chargeSelect.disabled = true;\n        modal.classList.replace('hidden', 'flex');\n    };\n    \n    const closeModal = () => modal.classList.replace('flex', 'hidden');\n    document.getElementById('pay-close-x').onclick = closeModal;\n    document.getElementById('pay-cancel').onclick = closeModal;\n\n    paySearchInput.addEventListener('input', () => {\n        const val = paySearchInput.value.toLowerCase();\n        autocompleteList.innerHTML = '';\n        if (!val) return autocompleteList.classList.add('hidden');\n\n        const students = getStudents();\n        const filtered = students.filter(s => {\n            const full = `${s.nombre} ${s.apellidoP} ${s.apellidoM}`.toLowerCase();\n            return full.includes(val) || String(s.numControl).includes(val);\n        }).slice(0, 5);\n\n        if (filtered.length > 0) {\n            filtered.forEach(s => {\n                const item = document.createElement('div');\n                item.className = 'px-4 py-3 hover:bg-gray-50 cursor-pointer border-b last:border-0';\n                item.innerHTML = `<div class=\"text-[10px] font-bold\">${s.nombre} ${s.apellidoP}</div><div class=\"text-[9px] text-gray-400\">${s.numControl}</div>`;\n                item.onclick = () => selectStudent(s);\n                autocompleteList.appendChild(item);\n            });\n            autocompleteList.classList.remove('hidden');\n        } else {\n            autocompleteList.classList.add('hidden');\n        }\n    });\n\n    function selectStudent(student) {\n        paySearchInput.value = '';\n        autocompleteList.classList.add('hidden');\n        selectedInfo.classList.remove('hidden');\n        document.getElementById('display-student-name').innerText = `${student.nombre} ${student.apellidoP} ${student.apellidoM}`;\n        document.getElementById('display-student-control').innerText = `No. Control: ${student.numControl}`;\n        \n        const allCharges = getCharges();\n        const concepts = getConcepts();\n        const studentCharges = allCharges.filter(c => \n            (String(c.studentId) === String(student.id) || String(c.studentId) === String(student.numControl)) &&\n            !['paid', 'pagado'].includes(String(c.status).toLowerCase())\n        );\n\n        chargeSelect.innerHTML = '<option value=\"\">Seleccione un adeudo...</option>';\n        if (studentCharges.length > 0) {\n            studentCharges.forEach(ch => {\n                const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n                const name = c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept);\n                const opt = document.createElement('option');\n                opt.value = ch.id;\n                opt.innerText = `${name} - ${fmt(ch.amount)}`;\n                chargeSelect.appendChild(opt);\n            });\n            chargeSelect.disabled = false;\n        } else {\n            chargeSelect.innerHTML = '<option>Sin adeudos pendientes</option>';\n            chargeSelect.disabled = true;\n        }\n    }\n\n    document.getElementById('pay-form').onsubmit = (e) => {\n        e.preventDefault();\n        const chargeId = chargeSelect.value;\n        const ref = document.getElementById('pay-code').value;\n        const method = document.getElementById('pay-method').value;\n\n        let charges = getCharges();\n        const idx = charges.findIndex(c => String(c.id) === String(chargeId));\n\n        if (idx !== -1) {\n            charges[idx].status = 'paid';\n            charges[idx].paymentDate = new Date().toISOString();\n            charges[idx].reference = ref;\n            charges[idx].method = method;\n            saveCharges(charges);\n            closeModal();\n            renderTable();\n        }\n    };\n\n    searchInput.addEventListener('input', () => { currentPage = 1; renderTable(); });\n    renderTable();\n  <\/script> "], [" ", '<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 bg-gray-50/50 min-h-screen"> <header class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-10 pb-8 border-b-2 border-[#2D584C]/10"> <div class="flex items-center gap-4 w-full justify-start"> <div class="p-3 bg-[#2D584C] rounded-xl shadow-lg shrink-0"> <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8V6m0 4v2m0 2v2m0 0V4m-7 8a7 7 0 1114 0 7 7 0 01-14 0z"></path> </svg> </div> <div class="text-left"> <h1 class="text-3xl font-black text-gray-900 tracking-tight leading-none text-left">Estado de Adeudos</h1> <p class="text-sm text-gray-500 mt-1 font-medium text-left">Cargos pendientes por cobrar.</p> </div> </div> <div class="flex flex-wrap items-center gap-3 w-full lg:w-auto justify-start lg:justify-end"> <div class="relative w-full lg:w-[300px]"> <input type="text" id="search-input" placeholder="Buscar alumno..." class="w-full pl-4 h-[46px] border-2 border-gray-200 rounded-xl text-sm outline-none focus:border-[#2D584C] bg-white shadow-sm"> </div> <button id="open-pay-modal-btn" class="h-[46px] px-5 bg-[#2D584C] text-white rounded-xl shadow-md hover:brightness-110 transition-all flex items-center justify-center text-[10px] font-black uppercase tracking-widest gap-2 shrink-0">\nRegistrar Pago\n</button> <button id="export-xlsx" class="h-[46px] px-5 bg-emerald-600 text-white rounded-xl shadow-md hover:bg-emerald-700 transition-all flex items-center justify-center text-[10px] font-black uppercase tracking-widest gap-2">\nEXPORTAR EXCEL\n</button> </div> </header> <div class="bg-white rounded-[2rem] shadow-2xl border border-gray-100 overflow-hidden"> <div class="overflow-x-auto"> <table class="min-w-full border-collapse"> <thead class="bg-[#2D584C]"> <tr> <th class="px-8 py-5 text-left text-[10px] font-black text-white uppercase tracking-widest">Estudiante</th> <th class="px-8 py-5 text-left text-[10px] font-black text-white uppercase tracking-widest">Concepto</th> <th class="px-8 py-5 text-right text-[10px] font-black text-white uppercase tracking-widest">Monto</th> </tr> </thead> <tbody id="payments-table-body" class="bg-white divide-y divide-gray-50"></tbody> </table> </div> <div class="px-8 py-4 bg-gray-50 border-t border-gray-100 flex flex-col sm:flex-row justify-between items-center gap-4"> <span id="pagination-info" class="text-[11px] font-bold text-gray-500 uppercase">Mostrando 0 de 0 adeudos</span> <div class="flex items-center gap-2" id="pagination-buttons"></div> </div> </div> </div> <div id="pay-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm p-4 text-left"> <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl"> <div class="flex justify-between items-center mb-4 border-b pb-3"> <h3 class="text-lg font-black text-gray-900">Registrar Pago</h3> <button id="pay-close-x" class="text-gray-400">\u2715</button> </div> <form id="pay-form" class="space-y-3"> <div class="grid grid-cols-2 gap-3"> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Referencia / Folio</label> <input id="pay-code" type="text" placeholder="Ej: 4567" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold uppercase" required> </div> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">M\xE9todo</label> <select id="pay-method" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold" required> <option value="Transferencia">Transferencia</option> <option value="Dep\xF3sito">Dep\xF3sito</option> </select> </div> </div> <div class="relative"> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Buscar Alumno</label> <input id="pay-student-search" type="text" autocomplete="off" placeholder="Nombre o No. Control..." class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs"> <div id="autocomplete-list" class="absolute z-20 w-full bg-white border rounded-xl mt-1 shadow-2xl max-h-40 overflow-y-auto hidden"></div> </div> <div id="selected-student-info" class="hidden p-3 bg-emerald-50 border border-emerald-100 rounded-lg"> <div id="display-student-name" class="text-[11px] font-black text-[#2D584C] uppercase"></div> <div id="display-student-control" class="text-[9px] font-mono font-bold text-emerald-600/70"></div> </div> <div> <label class="block text-[9px] font-black text-gray-400 uppercase mb-1">Adeudo Correspondiente</label> <select id="pay-charge-id" class="w-full border-2 border-gray-100 rounded-lg px-3 py-2 text-xs font-bold disabled:opacity-50" disabled required> <option value="">Primero selecciona un alumno</option> </select> </div> <div class="flex justify-end gap-2 pt-3 border-t mt-4"> <button type="button" id="pay-cancel" class="px-4 py-2 text-gray-400 font-bold text-[9px] uppercase">Cancelar</button> <button type="submit" class="px-6 py-2 bg-[#2D584C] text-white rounded-lg font-black text-[9px] uppercase tracking-widest">Confirmar Pago</button> </div> </form> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" referrerpolicy="no-referrer" defer><\/script> <script>(function(){', "\n    window.__CAREER_MAP = JSON.parse(careerMapJSON);\n  })();<\/script> <script type=\"module\">\n    const ITEMS_PER_PAGE = 50;\n    let currentPage = 1;\n\n    const getCharges = () => JSON.parse(localStorage.getItem('chargesList') || '[]');\n    const getStudents = () => JSON.parse(localStorage.getItem('studentsList') || '[]');\n    const getConcepts = () => JSON.parse(localStorage.getItem('conceptsList') || '[]');\n    const saveCharges = (data) => localStorage.setItem('chargesList', JSON.stringify(data));\n    const fmt = n => '$' + Number(n).toLocaleString('es-MX', { minimumFractionDigits: 2 });\n\n    const tableBody = document.getElementById('payments-table-body');\n    const searchInput = document.getElementById('search-input');\n    const paginationInfo = document.getElementById('pagination-info');\n    const paginationButtons = document.getElementById('pagination-buttons');\n\n    function renderTable() {\n        const term = searchInput.value.toLowerCase();\n        const students = getStudents();\n        const concepts = getConcepts();\n        \n        const allPending = getCharges().filter(c => !['paid', 'pagado'].includes(String(c.status).toLowerCase()));\n        \n        const filtered = allPending.filter(ch => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const sFullName = \\`\\${s.nombre} \\${s.apellidoP} \\${s.apellidoM}\\`.toLowerCase();\n            return !term || sFullName.includes(term) || String(s.numControl).includes(term);\n        });\n\n        const totalItems = filtered.length;\n        const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n        if (currentPage > totalPages) currentPage = totalPages || 1;\n        \n        const start = (currentPage - 1) * ITEMS_PER_PAGE;\n        const pageData = filtered.slice(start, start + ITEMS_PER_PAGE);\n\n        tableBody.innerHTML = pageData.map((ch) => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n            const conceptName = c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept || 'CARGO');\n            const sFullName = [s.nombre, s.apellidoP, s.apellidoM].filter(Boolean).join(' ');\n\n            return \\`\n              <tr class=\"hover:bg-gray-50 transition-all border-l-4 border-transparent hover:border-[#2D584C]\">\n                <td class=\"px-8 py-5\">\n                    <div class=\"text-[12px] font-black text-gray-900 uppercase\">\\${sFullName}</div>\n                    <div class=\"text-[9px] text-gray-400 font-mono font-bold\">\\${s.numControl || '-'}</div>\n                </td>\n                <td class=\"px-8 py-5 text-[11px] text-gray-500 font-bold uppercase\">\\${conceptName}</td>\n                <td class=\"px-8 py-5 text-right text-sm font-black text-red-600 font-mono\">\\${fmt(ch.amount)}</td>\n              </tr>\n            \\`;\n        }).join('');\n\n        updatePaginationControls(totalItems, totalPages);\n    }\n\n    function updatePaginationControls(totalItems, totalPages) {\n        const startItem = totalItems === 0 ? 0 : (currentPage - 1) * ITEMS_PER_PAGE + 1;\n        const endItem = Math.min(currentPage * ITEMS_PER_PAGE, totalItems);\n        paginationInfo.innerText = \\`Mostrando \\${startItem}-\\${endItem} de \\${totalItems} registros\\`;\n        paginationButtons.innerHTML = '';\n        if (totalPages <= 1) return;\n        \n        const createBtn = (text, targetPage, active = false, disabled = false) => {\n            const btn = document.createElement('button');\n            btn.innerText = text;\n            btn.className = \\`min-w-[32px] h-8 px-2 rounded-lg text-xs font-black \\${active ? 'bg-[#2D584C] text-white' : disabled ? 'text-gray-300' : 'text-gray-500 hover:bg-gray-200'}\\`;\n            if (!disabled) btn.onclick = () => { currentPage = targetPage; renderTable(); window.scrollTo(0,0); };\n            return btn;\n        };\n        paginationButtons.appendChild(createBtn('\u2190', currentPage - 1, false, currentPage === 1));\n        for (let i = 1; i <= totalPages; i++) {\n            if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {\n                paginationButtons.appendChild(createBtn(i, i, currentPage === i));\n            }\n        }\n        paginationButtons.appendChild(createBtn('\u2192', currentPage + 1, false, currentPage === totalPages));\n    }\n\n    // --- L\xD3GICA DE EXPORTACI\xD3N EXCEL ---\n    document.getElementById('export-xlsx').onclick = () => {\n        const charges = getCharges().filter(c => !['paid', 'pagado'].includes(String(c.status).toLowerCase()));\n        const students = getStudents();\n        const concepts = getConcepts();\n\n        const data = charges.map(ch => {\n            const s = students.find(x => String(x.id) === String(ch.studentId) || String(x.numControl) === String(ch.studentId)) || {};\n            const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n            return {\n                'No. Control': s.numControl || 'N/A',\n                'Nombre Completo': \\`\\${s.nombre || ''} \\${s.apellidoP || ''} \\${s.apellidoM || ''}\\`.trim(),\n                'Carrera': window.__CAREER_MAP[s.carrera] || s.carrera || 'N/A',\n                'Grado/Grupo': \\`\\${s.grado || ''}\xB0 \\${s.grupo || ''}\\`,\n                'Concepto': c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept),\n                'Monto': ch.amount,\n                'Estatus': 'PENDIENTE'\n            };\n        });\n\n        const worksheet = XLSX.utils.json_to_sheet(data);\n        const workbook = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(workbook, worksheet, \"Adeudos\");\n        XLSX.writeFile(workbook, \\`Adeudos_CBTA71_\\${new Date().toLocaleDateString()}.xlsx\\`);\n    };\n\n    // --- L\xD3GICA DEL MODAL Y AUTOCOMPLETADO ---\n    const modal = document.getElementById('pay-modal');\n    const paySearchInput = document.getElementById('pay-student-search');\n    const autocompleteList = document.getElementById('autocomplete-list');\n    const selectedInfo = document.getElementById('selected-student-info');\n    const chargeSelect = document.getElementById('pay-charge-id');\n\n    document.getElementById('open-pay-modal-btn').onclick = () => {\n        document.getElementById('pay-form').reset();\n        selectedInfo.classList.add('hidden');\n        chargeSelect.disabled = true;\n        modal.classList.replace('hidden', 'flex');\n    };\n    \n    const closeModal = () => modal.classList.replace('flex', 'hidden');\n    document.getElementById('pay-close-x').onclick = closeModal;\n    document.getElementById('pay-cancel').onclick = closeModal;\n\n    paySearchInput.addEventListener('input', () => {\n        const val = paySearchInput.value.toLowerCase();\n        autocompleteList.innerHTML = '';\n        if (!val) return autocompleteList.classList.add('hidden');\n\n        const students = getStudents();\n        const filtered = students.filter(s => {\n            const full = \\`\\${s.nombre} \\${s.apellidoP} \\${s.apellidoM}\\`.toLowerCase();\n            return full.includes(val) || String(s.numControl).includes(val);\n        }).slice(0, 5);\n\n        if (filtered.length > 0) {\n            filtered.forEach(s => {\n                const item = document.createElement('div');\n                item.className = 'px-4 py-3 hover:bg-gray-50 cursor-pointer border-b last:border-0';\n                item.innerHTML = \\`<div class=\"text-[10px] font-bold\">\\${s.nombre} \\${s.apellidoP}</div><div class=\"text-[9px] text-gray-400\">\\${s.numControl}</div>\\`;\n                item.onclick = () => selectStudent(s);\n                autocompleteList.appendChild(item);\n            });\n            autocompleteList.classList.remove('hidden');\n        } else {\n            autocompleteList.classList.add('hidden');\n        }\n    });\n\n    function selectStudent(student) {\n        paySearchInput.value = '';\n        autocompleteList.classList.add('hidden');\n        selectedInfo.classList.remove('hidden');\n        document.getElementById('display-student-name').innerText = \\`\\${student.nombre} \\${student.apellidoP} \\${student.apellidoM}\\`;\n        document.getElementById('display-student-control').innerText = \\`No. Control: \\${student.numControl}\\`;\n        \n        const allCharges = getCharges();\n        const concepts = getConcepts();\n        const studentCharges = allCharges.filter(c => \n            (String(c.studentId) === String(student.id) || String(c.studentId) === String(student.numControl)) &&\n            !['paid', 'pagado'].includes(String(c.status).toLowerCase())\n        );\n\n        chargeSelect.innerHTML = '<option value=\"\">Seleccione un adeudo...</option>';\n        if (studentCharges.length > 0) {\n            studentCharges.forEach(ch => {\n                const c = concepts.find(con => String(con.id) === String(ch.conceptId));\n                const name = c ? (c.title || c.concept) : (ch.conceptTitle || ch.concept);\n                const opt = document.createElement('option');\n                opt.value = ch.id;\n                opt.innerText = \\`\\${name} - \\${fmt(ch.amount)}\\`;\n                chargeSelect.appendChild(opt);\n            });\n            chargeSelect.disabled = false;\n        } else {\n            chargeSelect.innerHTML = '<option>Sin adeudos pendientes</option>';\n            chargeSelect.disabled = true;\n        }\n    }\n\n    document.getElementById('pay-form').onsubmit = (e) => {\n        e.preventDefault();\n        const chargeId = chargeSelect.value;\n        const ref = document.getElementById('pay-code').value;\n        const method = document.getElementById('pay-method').value;\n\n        let charges = getCharges();\n        const idx = charges.findIndex(c => String(c.id) === String(chargeId));\n\n        if (idx !== -1) {\n            charges[idx].status = 'paid';\n            charges[idx].paymentDate = new Date().toISOString();\n            charges[idx].reference = ref;\n            charges[idx].method = method;\n            saveCharges(charges);\n            closeModal();\n            renderTable();\n        }\n    };\n\n    searchInput.addEventListener('input', () => { currentPage = 1; renderTable(); });\n    renderTable();\n  <\/script> "])), maybeRenderHead(), defineScriptVars({ careerMapJSON })) })}`;
}, "C:/Users/sarah/Documents/GitHub/CBTA/Frond-end/src/pages/debts.astro", void 0);

const $$file = "C:/Users/sarah/Documents/GitHub/CBTA/Frond-end/src/pages/debts.astro";
const $$url = "/debts";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Debts,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
